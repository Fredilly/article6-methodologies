# RC-20260101-081624 — pdfminer CLI fallback returns empty text
- Date: 2026-01-01
- Area: pdf
Tags: [pdf, agriculture, ci]

## Symptom
Rules extraction emitted empty `rules.json` + `rules.rich.json` for UNFCCC Agriculture `AMS-III.{A,AU,BF,BK}` (previous versions), while other AMS-III families (e.g. `AMS-III.D`, `AMS-III.R`) produced non-empty rules.

## Impact
- Rules coverage gaps for affected methodology families (silent “empty rules” outputs).
- Downstream evaluation/quality checks saw structurally valid but semantically empty artefacts.

## Root cause
`scripts/extract-sections.cjs` fell back to invoking `pdfminer` via `python3 -m pdfminer.high_level ...`, which returned empty stdout in CI. This left `sections.json` without extracted `content`, so `scripts/derive-rules-rich.cjs` had no inputs and produced 0 rules.

## Fix
- Switch the pdfminer fallback to call `pdfminer.high_level.extract_text()` via `python3 -c ...` (reliable stdout text extraction).
- Improve strict-mode diagnostics in `scripts/derive-rules-rich.cjs` when 0 rules are produced due to 0 contentful sections.

## New invariants / guardrails
- PDF text extraction fallback must yield non-empty text for text-based PDFs (or fail loudly when no extractable text exists).

## Proof / tests
- `tests/extract-sections-pdfminer.test.js`
- `tests/agri-ams-iii-rules-coverage.test.js`
- `npm test`
- `npm run validate:all`

## Follow-ups
- [ ] Consider broadening `scripts/extract-sections.cjs` heading detection for documents using non-numeric/roman section headers if section splitting proves brittle.
