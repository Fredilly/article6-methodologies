# RC-20251221-120500 - Scoped ingest portability failure (macOS mktemp/mapfile bashisms)

- **Title:** Scoped ingest portability failure (macOS mktemp/mapfile bashisms)
- **Date:** 2025-12-21
- **Owners:** Fred E
- **Linked invariant / plan section:** `docs/projects/phase-1-ingestion/ARTICLE6_INGEST_UPGRADE_PLAN.md`

## Summary
Scoped/idempotent ingest failed or behaved inconsistently on macOS due to non-portable shell assumptions (mktemp/mapfile).

## Root Cause
`scripts/ingest-scoped.sh` relied on GNU/bashisms not present in the default macOS toolchain.

## Fix
Made `scripts/ingest-scoped.sh` portable (BSD `mktemp` compatible, avoid `mapfile`) while preserving determinism and idempotency checks.

## Follow-up / Tests
- Proof on macOS:
  - `npm run ingest:scoped:idempotent -- ingest.<scope>.yml`
  - `npm run validate:rich`
  - `npm run validate:lean`
- Acceptance check:
  - Second run produces no diffs: `git diff` empty and `git status -sb` clean after the idempotent run.
