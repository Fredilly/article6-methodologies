# RC-20251225-085326 â€” Stale GitHub check badges + Forestry previous lockfile path mismatch (source-assets -> registry)
- Date: 2025-12-25
- Area: ci/registry/paths
Tags: [ci, registry, paths, forestry]

## Symptom
GitHub folder/file views showed red checks even though PR HEAD checks were green; earlier stage-gates failures occurred when Forestry scripts looked for source-assets/UNFCCC/Forestry/previous-versions.lock.json while the lockfile lived in registry/UNFCCC/Forestry/previous-versions.lock.json.

## Impact
Wasted time chasing non-HEAD failures; real risk of CI failing if legacy paths remain in scripts/ingest-scope.

## Root cause
File/folder badges can reflect checks from older SHAs (commit that last touched the file), not the PR HEAD. Forestry scripts referenced legacy source-assets paths and ingest-scope fallback only handled Agriculture.

## Fix
Updated Forestry scripts to use registry/UNFCCC/Forestry/previous-versions.lock.json and generalized ingest-scope fallback to rewrite source-assets -> registry when the relocated lock exists.

## New invariants / guardrails
- [ ] Rule: merge decisions must use PR HEAD checks (gh pr checks), never file/folder badges
- [ ] Canonical previous lockfiles live under registry/UNFCCC/<Sector>/
- [ ] Drift checks must cover both Forestry and Agriculture

## Proof / tests
gh pr checks 329 (HEAD green); gh run list --branch feat/unfccc-forestry-include-previous-v3 shows failures only on non-HEAD SHAs; npm run previous:drift:forestry; npm run ingest:forestry:with-previous

## Follow-ups
- [ ] Add checklist snippet: compare failing run headSha vs PR headRefOid
- [ ] Ensure stage-gates runs previous:drift for Forestry + Agriculture
